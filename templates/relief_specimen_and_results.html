{% extends "base.html" %} 
{% load static %} 
{% load crispy_forms_tags %} 
{% load custom_filters %}
{% block content %}

  <!-- SECTION FOR THE CONTENT SCRIPTS -->

  <!--  -- E Charts-->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.1/dist/echarts.min.js"></script>

<!-- start Data Table libraries  -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.7.0/jszip-3.10.1/dt-1.13.5/af-2.6.0/b-2.4.1/b-colvis-2.4.1/b-html5-2.4.1/b-print-2.4.1/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.1/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.css" rel="stylesheet">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.7.0/jszip-3.10.1/dt-1.13.5/af-2.6.0/b-2.4.1/b-colvis-2.4.1/b-html5-2.4.1/b-print-2.4.1/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.1/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
<!-- end Datatable -->
 
<script>
  var jQuery_3_6_0 = $.noConflict(true);
  </script>
  

<!-- these are libraries for MULTIPLE SELECT -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->
<script src="{% static 'assets/js/jquery.min.js'%}"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<!-- end of libraries for multiple select -->
<script>
  var jQuery_2_1_1 = $.noConflict(true);
  </script>

<!-- SweetAlert2 stylesheet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>


<script type="text/javascript">
  window.onload = function() {
      document.body.style.zoom = "90%";
  }
</script>



<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src=" {% static 'assets/js/echarts.min.js'%}"></script>
<!-- Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<!--  -->


<style>

    /* Common properties for td and th */
    .disp td, .disp th {
        border-right: 1px solid #ddd; /* Right border for each cell */
        font-size: 0.8em; /* Reduced font size for all cells */
        text-align: center; /* Horizontally center the content */
        vertical-align: middle; /* Vertically center the content */
    }
    
    .disp th, .disp td {
        border-bottom: 1px solid #ddd; /* Bottom border for each cell */
    }
    
    /* Specific properties for th */
    .disp th {
        font-weight: normal; /* Headers are not bold */
        padding: 10px; /* Space around headers */
        /* border-right and font-size are already defined above, no need to repeat */
    }
    
    /* Adjusting for the last-child specifics */
    .disp tr:last-child td {
        border-bottom: none; /* Remove bottom border for the last row */
    }
    
    .disp thead th:last-child, .disp tbody td:last-child {
        border-right: none; /* Remove right border for the last column */
    }
    
    




    
    .display td, .display th {
        border-right: 1px solid #ddd; /* Right border for each cell */
        font-size: 0.9em; /* Reduced font size for all cells */
    }
    .display th, .display td {
        border-bottom: 1px solid #ddd; /* Bottom border for each cell */
    }
    .display tr:last-child td {
        border-bottom: none; /* Remove bottom border for the last row */
    }
    .display thead th:last-child, .display tbody td:last-child {
        border-right: none; /* Remove right border for the last column */
    }

    .wrap-comments {
    word-wrap: break-word; 
    max-width: 1600px; /* or whatever maximum width you want */
     }

        .hide-element {
        display: none;
    }

      .bg-none {
          background-color: #f3f3f3; /* or any color you'd like */
      }


          /* Targeting the 2nd, 3rd, and 4th columns of the table */
    #AgeOldestsample td:nth-child(2),
    #AgeOldestsample td:nth-child(3),
    #AgeOldestsample td:nth-child(4) {
        width: 100px; /* Or whatever width you prefer */
    }


          /* Define the rotation animation */
      @keyframes rotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
      }

      /* Apply the animation to the loading element */
      .loading {
          animation: rotate 1.5s linear infinite;
      }

 /* Style for the button */
 button {
            background-color: #e0e0e0; /* Light gray background */
            color: #a0a0a0; /* Faint text color */
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.3s; /* Transition effect for hover */
        }

        button:hover {
            background-color: #c0c0c0; /* Slightly darker gray for hover */
        }

        i.bi {
            margin-right: 5px; /* Spacing between the icon and the text */
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .rotate-icon {
            animation: rotate 2s linear infinite;
        }


        #submitsync.active {
        background-color: rgb(147, 147, 245) !important;
        border-color: rgb(147, 147, 245) !important;
        font-weight: bold;
        color: black;
        }

/* loader for spinning */
    .loader {
    border: 16px solid #f3f3f3;
    /* Light grey */
    border-top: 16px solid #3498db;
    /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }


  .province-cell {
    cursor: pointer;
    text-decoration: underline;
    color: blue;  // or any other color to indicate it's a link
}

.province-cell:hover {
    background-color: #f5f5f5;  // light gray background on hover
}

.highcharts-figure,
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

#container {
    height: 400px;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}



</style>



<div class="modal fade" id="provinceModal" tabindex="-1" role="dialog" aria-labelledby="provinceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="provinceModalLabel">Province Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Data will be populated here dynamically -->
            </div>
        </div>
    </div>
</div>



<!-- This is the section we are to put the spinning -->

<div id="spinner" class="loader" style="display:none;"></div>
<!-- end of spinning code -->




<form method="post" enctype="multipart/form-data" id="sync-form"></form>
{% csrf_token %}  
<div class="row">  
    <div class="col-lg-6">       
         
               <!-- <button class="btn btn-primary" type="button" disabled>
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Loading...
              </button> -->


    </div>
    <!-- style="font-size: 2rem;" -->
    <div class="col-lg-6">
        <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><i class="bi bi-pc-display-horizontal"  ></i></li>
              <li class="breadcrumb-item"><a href="#">Last uploaded  date: </a></li>
              <li class="breadcrumb-item ">{{last_Uploaded_date}}</li>
            </ol>
        </nav>
         
    </div>
   


    {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-octagon me-1"></i>
    {{ message|safe }} <br>      
     <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}    
</div>
</form>


<!-- lets put the filters -->
{% load crispy_forms_tags %}
<form method="POST">
    {% csrf_token %}

    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="alert border-primary alert-dismissible fade show" role="alert">
                    <div class="row">

                        <div class="col-lg-3" style="display: flex; align-items: center;">
                            <i class="bi bi-book-" style="font-size: 4em;"></i>
                            <span style="margin-left: 2em;">
                                <strong>Apply the filter<br> <i>By default analysis is for this week</i></strong>
                            </span>
                        </div>


                        <div class="col-lg-3">
                            <label for="inputDate" style="font-weight: bold; font-family: Arial, sans-serif;">Start
                                Date</label>
                            <input type="date" id="startdate" name="startdate" class="form-control" required>
                        </div>

                        <div class="col-lg-3">
                            <label for="inputDate" style="font-weight: bold; font-family: Arial, sans-serif;">End
                                Date</label>
                            <input type="date" id="enddate" name="enddate" class="form-control" required>
                        </div>

                        <div class="col-lg-3">
                            <label for="inputDate"
                                style="font-weight: bold; font-family: Arial, sans-serif;">.</label><br>
                            <button  id="submitfilterx" name="submitfilterx" class="btn btn-primary"
                                style="font-size: 20px; ">Submit</button>

                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>
</form>
<!-- end of filters -->

<figure>
    <blockquote class="blockquote">
      <p>RELIEF RIDERS ANALYSIS -.</p>
    </blockquote>
    <figcaption class="blockquote-footer">
      We are going to analyse the work done by   <cite title="Source Title"> RELIEF RIDERS </cite> in detail.
    </figcaption>
  </figure>


<div class="row">  
    <div class="col-lg-4">  
        <div class="card">
            <div class="card-body">
                <div id="container"  style="width: 100%; height: 300px"></div>
                <script>                     
                    document.addEventListener('DOMContentLoaded', function () {                        

                var Pepfar_relief_int =  [
                    {% for result in data %}
                                {% if result.query_name == 'ist_getTA_DSD_relief' %}
                                    {% for row in result.query_data %}
                                    {% if row.Type_of_PEPFAR_Support == 'Pepfar' %}
                                    {{ row|get_item:"Type_of_PEPFAR_Support"|default:0 }} = {{ row.relief_riders }}
                                        {% endif %}                               
                                    {% endfor %}
                                {% endif %}
                            {% endfor %} ];
                var Pepfar_relief=Pepfar_relief_int[0]  


                var GF_relief_int =  [
                {% for result in data %}
                            {% if result.query_name == 'ist_getTA_DSD_relief' %}
                                {% for row in result.query_data %}
                                {% if row.Type_of_PEPFAR_Support == 'Global_Fund' %}
                                {{ row|get_item:"Type_of_PEPFAR_Support"|default:0 }} = {{ row.relief_riders }}
                                    {% endif %}                               
                                {% endfor %}
                            {% endif %}
                        {% endfor %} ];
                var GF_relief=GF_relief_int[0] 

                
            // Create the chart
            Highcharts.chart('container', {
                chart: {
                    type: 'pie'
                },
                title: {
                    text: 'DSD / TAT Relief Riders ',
                    align: 'left',
                    style: {
                                    fontSize: '15px', // or any other size you prefer                         
                                }
                },
                subtitle: {
                    text: 'Engaged',
                    align: 'left'
                },

                accessibility: {
                    announceNewData: {
                        enabled: true
                    },
                    point: {
                        valueSuffix: '#'
                    }
                },

                plotOptions: {
                    
                    series: {
                        borderRadius: 5,
                        dataLabels: {
                            enabled: true,
                            format: '{point.name}: {point.y:.1f}'
                        }
                    }
                },

                tooltip: {
                    headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                    pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}</b> riders<br/>'
                },
                colors: ['#7cb5ec', '#f7a35c'],  // Your array of colors
                series: [
                    {
                        name: 'Relief Riders',
                        colorByPoint: true,
                        data: [
                            {
                                name: 'TAT \n (Global Fund)',
                                y: GF_relief,
                                drilldown: 'TAT'
                            },
                            
                            {
                                name: 'DSD (Pepfar)',
                                y: Pepfar,
                                drilldown: 'DSD'
                            }
                         
                            
                        ]
                    }
                ],

            });
                            


                    });
                </script>



            </div>
        </div>
    </div>


    <div class="col-lg-8">  
        <div class="card">
            <div class="card-body">
                <div id="relief_totalsamples"  style="width: 100%; height: 400px"></div>
                <script>                     
                    document.addEventListener('DOMContentLoaded', function () { 

                        
            var province = [ 
                {% for result in data %}
                            {% if result.query_name == 'ist_reliefSamples_transported' %}
                                {% for row in result.query_data %}
                                '{{ row|get_item:"Province_"|default:"" }}', 
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
    
                    ];
            
                  var series_samDict = {};
                                  {% for result in data %}
                                  {% if result.query_name == 'ist_reliefSamples_transported' %}
                                      {% for row in result.query_data %}
                                      series_samDict['{{ row|get_item:"Province_"|default:"" }}'] = '{{ row.total_sam }}';
                                      {% endfor %}
                                  {% endif %}
                                  {% endfor %}
                
                  var series_sam = province.map(function(o) {
                                    return parseInt(series_samDict[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                                });
    
                 // Step 2: Use the reduce method to sum up the elements
                var sumsam = series_sam.reduce(function(a, b) {
                    return a + b;
                }, 0); // 0 is the initial value
    
                //----------------------------------------------------->
                var series_resDict = {};
                {% for result in data %}
                {% if result.query_name == 'ist_reliefSamples_transported' %}
                    {% for row in result.query_data %}
                    series_resDict['{{ row|get_item:"Province_"|default:"" }}'] = '{{ row.total_res }}';
                    {% endfor %}
                {% endif %}
                {% endfor %}

                var series_res = province.map(function(o) {
                                return parseInt(series_resDict[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                            });

                // Step 2: Use the reduce method to sum up the elements
                var sumres = series_res.reduce(function(a, b) {
                return a + b;
                }, 0); // 0 is the initial value






                        Highcharts.chart('relief_totalsamples', {
                            chart: {
                                type: 'column'
                            },
                            title: {
                                text: 'Relief Riders Samples & Results',
                                align: 'left',
                                style: {
                                    fontSize: '15px', // or any other size you prefer                         
                                }
                            },
                            xAxis: {
                                categories: province,
                                labels: {
                                    rotation: -45, 
                                    style: {
                                        fontSize: '13px',
                                        fontFamily: 'Verdana, sans-serif'
                                    }
                                }
                            },
                            yAxis: [{
                                min: 0,
                                title: {
                                    text: '# samples/results transported'
                                }
                            }],
                            legend: {
                                shadow: false
                            },
                            tooltip: {
                                shared: true
                            },
                            plotOptions: {
                                column: {
                                    grouping: false,
                                    shadow: false,
                                    borderWidth: 0,
                                    dataLabels: {
                                        enabled: true
                                    },
                                    groupPadding: 0.1
                                }
                            },
                          
                            series: [{
                                name: `Results (${sumres})`,
                                color: 'rgba(165,170,217,1)',
                                data: series_res,
                                pointPadding: 0.3,
                                pointPlacement: -0.2
                            }, {
                                name: `Samples (${sumsam})`,
                                color: 'rgba(126,86,134,.9)',
                                data: series_sam,
                                pointPadding: 0.4,
                                pointPlacement: -0.2
                            }]
                       
                        });
                        


                        
                    });
                </script>

            </div>
        </div>

        <div class='row'>
            <div class="col-lg-12">  
            
  <!-- Table to show by lab --> 
  <table width="100%" id="unresolved_missing" class="disp table-responsive">
    <thead>
        <tr>
            {% for header in headers_ref %}
                <th>{{ header }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for result in data %}
            {% if result.query_name == 'ist_relief_riders_per_province' %}
                {% for row in result.query_data %}
                    <tr>
                        {% for header in headers_ref %}
                            {% with cell_value=row|get_item:header %}
                                {% if cell_value == None or cell_value == 0 %}
                                    <td style="background-color: rgb(55, 54, 54)7, 86, 86);"></td>
                                {% else %}
                                    <td>{{ cell_value }}</td>
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </tbody>
</table> 

<br>
<figure>

    <figcaption class="blockquote-footer">
      Number of Relief Riders per province.
    </figcaption>
  </figure>





<!-- end of the table -->
</div>
</div>
    </div><!---- end of div-->


</div><!-- end of row-->




<br>

    
          
         <div class="col-lg-12">
            <div class="card">
                <hr>
            </div>
        </div>



        <figure>
            <blockquote class="blockquote">
              <p>
                <span style="color: red;"> <strong> RELIEF  RIDERS </strong> </span>  samples & Results transported -(by province).</p>
           
            </blockquote>
            <figcaption class="blockquote-footer">
             Overal Disaggregation of  samples transported by    <cite title="Source Title" style="color: red;"><strong>RELIEF RIDERS</strong></cite>

              by Province.<br>    
            </figcaption>
          </figure> <br>
      
        <!-- Column Chart -->
        

        <table width="100%" id="specimes" class="display table-responsive">
            <thead>
              <tr>
                <th>Province</th>
                <th>Total VL and EID Specimens</th>
                <th>Total VL and EID Results </th>
                <th>TB Specimens</th>
                <th>Results TB  </th>
                <th>VL Plasma & DBS </th>
                <th>EID Plasma & DBS </th>
                <th>HPV</th>
                <th>Results HPV </th>
                <th>Results VL Plasma & DBS </th>
                <th>Results EID Plasma & DBS </th>
                      
              </tr>
            </thead>
            <tbody>
              {% for result in data %}
                  {% if result.query_name == 'ist_reliefSamples_transported' %}
                      {% for row in result.query_data %}
                          <tr>
                              <td>{{ row|get_item:"Province_"|default:0 }} </td>
                              <td>{{ row|get_item:"total_vl_eid_sam"|default:0 }}</td>
                              <td> {{ row|get_item:"total_vl_eid_res"|default:0 }}   </td>
                              <td >{{ row|get_item:"Sputum_Culture_DR_NTBRL"|default:0 }}    </td>
                              <td > {{ row|get_item:"Sputum_Culture_DR_NTBRL_res"|default:0 }}  </td>

                              <td > {{ row|get_item:"VL_Plasma_DBS"|default:0 }}  </td>
                              <td > {{ row|get_item:"EID_Plasma_DBS"|default:0 }}  </td>

                              <td > {{ row|get_item:"HPV"|default:0 }}  </td>
                              <td > {{ row|get_item:"HPV_res"|default:0 }}  </td>

                              <td > {{ row|get_item:"VL_Plasma_DBS_res"|default:0 }}  </td>
                              <td > {{ row|get_item:"EID_Plasma_DBS_res"|default:0 }}  </td>
                          </tr>
                      {% endfor %}
                  {% endif %}
              {% endfor %}
              </tbody>
          </table>
                            
        <!-- End Column Chart -->



        <div class="col-lg-12">
            <div class="card"><br>
                <figure>                   
                    <figcaption class="blockquote-footer">
                      These is an overview of  specimens and results transported by relief riders per province
                    </figcaption>
                  </figure>
            </div>
        </div>

<div class="row">
        <div class="col-lg-6"><br>
            <figure>
                <blockquote class="blockquote">
                  <p>
                    <span style="color: red;"> <strong> VL/EID MONTHLY </strong> </span> DSD & TA_SDI - samples  -(trend Analysis).</p>
               
                </blockquote>
                <figcaption class="blockquote-footer">
                  Disaggregate the samples transported by    <cite title="Source Title" style="color: red;"><strong>RELIEF RIDERS</strong></cite>

                  by Pepfar and Global Fund.<br>    You can put the range dates to see the trend 
                </figcaption>
              </figure> <br>


              <div id="relifx"  style="width: 100%; height: 400px"></div>  

    
                <script>
                    document.addEventListener('DOMContentLoaded', function () { 
                        
                    var month_date = [];

                    var pepfar_data = [];
                    var pepfar_results=[];

                    var global_fund_data = [];
                    var global_fund_results=[];

                    var firstYValue;
                
                    {% for result in data %}
                    {% if result.query_name == 'ist_TAT_DSD_relief' %}
                        {% for row in result.query_data %}
                        // Check if month_date already contains the date
                        if (!month_date.includes('{{ row|get_item:"date"|default:"" }}')) {
                            month_date.push('{{ row|get_item:"date"|default:"" }}');

                            // If firstYValue is not set yet, set it
                        if (typeof firstYValue === "undefined") {
                                firstYValue = '{{ row.total_vl_eid_sam }}';
                            }

                            // Initialize the series data for this date
                            if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Pepfar') {

                                pepfar_data.push('{{ row.total_vl_eid_sam }}');
                                global_fund_data.push(0);  // Initialize with 0, will replace later if data exists

                                pepfar_results.push('{{ row.total_vl_eid_res }}');
                                global_fund_results.push(0);  // Initialize with 0, will replace later if data exists

                            } else if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Global_Fund') {
                                global_fund_data.push('{{ row.total_vl_eid_sam }}');
                                pepfar_data.push(0);  // Initialize with 0, will replace later if data exists

                                global_fund_results.push('{{ row.total_vl_eid_res }}');
                                pepfar_results.push(0);  // Initialize with 0, will replace later if data exists
                            }
                        } else {
                            // If the month_date already contains the date, just update the respective series data
                            var index = month_date.indexOf('{{ row|get_item:"date"|default:"" }}');
                            if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Pepfar') {
                                pepfar_data[index] = '{{ row.total_vl_eid_sam }}';
                                pepfar_results[index] = '{{ row.total_vl_eid_res }}';

                            } else if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Global_Fund') {
                                global_fund_data[index] = '{{ row.total_vl_eid_sam }}';
                                global_fund_results[index] = '{{ row.total_vl_eid_res }}';
                            }
                        }
                        {% endfor %}
                    {% endif %}
                    {% endfor %}



                    
                        // Create the specialDataPoint with the dynamic y value
                    var specialDataPoint = {
                        y: parseInt(firstYValue, 10),
                        marker: {
                            symbol: 'url(https://www.highcharts.com/samples/graphics/sun.png)'
                        },
                       
                    };


                    global_fund_data = global_fund_data.map(function(value) {
                        return parseInt(value, 10);
                    });
                

                    global_fund_results = global_fund_results.map(function(value) {
                        return parseInt(value, 10);
                    });
                

                    //turn them to integers
                    pepfar_data = pepfar_data.map(function(value) {
                        return parseInt(value, 10);
                    });
                    

                    pepfar_results = pepfar_results.map(function(value) {
                        return parseInt(value, 10);
                    });

               
                



              console.log(specialDataPoint);
            

                
                    Highcharts.chart('relifx', {
                        chart: {
                            type: 'spline'
                            //type: 'area'
                        },
                        title: {
                            text: ''
                        },
                       
                        xAxis: {
                            categories: month_date,
                            accessibility: {
                                description: 'Months of the year'
                            }
                        },
                        yAxis: {
                            title: {
                                text: '# of samples'
                            },
                            labels: {
                                format: '{value}'
                            }
                        },
                        tooltip: {
                            crosshairs: true,
                            shared: true
                        },
                        plotOptions: {
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#666666',
                                    lineWidth: 1
                                }
                            }
                        },
                        series: [{
                            name: 'Pepfar',
                            marker: {
                                symbol: 'square'
                            },
                            data: pepfar_data

                        }, {
                            name: 'Global Fund',
                            marker: {
                                symbol: 'diamond'
                            },
                            data: global_fund_data
                        },
                        {
                            name: 'Pepfar results',
                            marker: {
                                symbol: 'square'
                            },
                            data: pepfar_results

                        },
                        {
                            name: 'Global Fund Results',
                            marker: {
                                symbol: 'diamond'
                            },
                            data: global_fund_results
                        }



                        ]
                    });


                });
                </script>      

        </div>

        <div class="col-lg-6">
            <div class="card">
            <div class="card-body">
            <figure>
                <blockquote class="blockquote">
                  <p><span style="color: red;"> <strong> VL/EID WEEKLY </strong> </span>- DSD & TA_SDI - samples -(trend Analysis).</p>
               
                </blockquote>
                <figcaption class="blockquote-footer">
                  Disaggregate the samples transported by    <cite title="Source Title" style="color: red;"><strong>RELIEF RIDERS</strong></cite>

                  by Pepfar and Global Fund.<br>    You can put the range dates to see the trend 
                </figcaption>
              </figure> <br>


              <div id="relif"  style="width: 100%; height: 400px"></div>  

                
                <script>
                    document.addEventListener('DOMContentLoaded', function () { 
                        
                    var month_date = [];
                    var pepfar_data = [];
                    var global_fund_data = [];
                    var firstYValue;
                
                    {% for result in data %}
                    {% if result.query_name == 'ist_TAT_DSD_relief_by_week' %}
                        {% for row in result.query_data %}
                        // Check if month_date already contains the date
                        if (!month_date.includes('{{ row|get_item:"date"|default:"" }}')) {
                            month_date.push('{{ row|get_item:"date"|default:"" }}');

                            // If firstYValue is not set yet, set it
                        if (typeof firstYValue === "undefined") {
                                firstYValue = '{{ row.total_vl_eid_sam }}';
                            }

                            // Initialize the series data for this date
                            if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Pepfar') {
                                pepfar_data.push('{{ row.total_vl_eid_sam }}');
                                global_fund_data.push(0);  // Initialize with 0, will replace later if data exists

                            } else if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Global_Fund') {
                                global_fund_data.push('{{ row.total_vl_eid_sam }}');
                                pepfar_data.push(0);  // Initialize with 0, will replace later if data exists
                            }
                        } else {
                            // If the month_date already contains the date, just update the respective series data
                            var index = month_date.indexOf('{{ row|get_item:"date"|default:"" }}');
                            if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Pepfar') {
                                pepfar_data[index] = '{{ row.total_vl_eid_sam }}';
                            } else if('{{ row|get_item:"Type_of_PEPFAR_Support"|default:"" }}' == 'Global_Fund') {
                                global_fund_data[index] = '{{ row.total_vl_eid_sam }}';
                            }
                        }
                        {% endfor %}
                    {% endif %}
                    {% endfor %}



                    
                        // Create the specialDataPoint with the dynamic y value
                    var specialDataPoint = {
                        y: parseInt(firstYValue, 10),
                        marker: {
                            symbol: 'url(https://www.highcharts.com/samples/graphics/sun.png)'
                        },
                       
                    };


                    global_fund_data = global_fund_data.map(function(value) {
                        return parseInt(value, 10);
                    });
                

                    //turn them to integers
                    pepfar_data = pepfar_data.map(function(value) {
                        return parseInt(value, 10);
                    });
                    
               
                



              console.log(specialDataPoint);
            

                
                    Highcharts.chart('relif', {
                        chart: {
                            //type: 'spline'
                            type: 'area'
                        },
                        title: {
                            text: ''
                        },
                       
                        xAxis: {
                            categories: month_date,
                            accessibility: {
                                description: 'Months of the year'
                            }
                        },
                        yAxis: {
                            title: {
                                text: '# of samples'
                            },
                            labels: {
                                format: '{value}'
                            }
                        },
                        tooltip: {
                            crosshairs: true,
                            shared: true
                        },
                        plotOptions: {
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#666666',
                                    lineWidth: 1
                                }
                            }
                        },
                        series: [{
                            name: 'Pepfar',
                            marker: {
                                symbol: 'square'
                            },
                            data: pepfar_data

                        }, {
                            name: 'Global Fund',
                            marker: {
                                symbol: 'diamond'
                            },
                            data: global_fund_data
                        }]
                    });


                });
                </script>
               
            </div>
        </div>
        </div>

    </div> <!---end of row-->




    <div class="col-lg-12">
        <div class="card">
            <hr>
        </div>
    </div>
<br> 
<figure>
    <blockquote class="blockquote">
      <p>  WEEKLY  </span>- DSD & TA_SDI - samples line list.</p>
   
    </blockquote>
    
  </figure>

    <table width="100%" id="specimes" class="display table-responsive">
        <thead>
          <tr>
            <th>Week Date</th>
            <th>Funding</th>
            <th>Total VL and EID Specimens</th>
            <th>Total VL and EID Results </th>
            <th>TB Specimens</th>
            <th>Results TB  </th>
            <th>VL Plasma & DBS </th>
            <th>EID Plasma & DBS </th>
            <th>HPV</th>
            <th>Results HPV </th>
            <th>Results VL Plasma & DBS </th>
            <th>Results EID Plasma & DBS </th>
                  
          </tr>
        </thead>
        <tbody>
          {% for result in data %}
              {% if result.query_name == 'ist_TAT_DSD_relief_by_week' %}
                  {% for row in result.query_data %}
                      <tr>
                        <td>{{ row|get_item:"date"|default:0 }} </td>
                        <td>{{ row|get_item:"Type_of_PEPFAR_Support"|default:0 }}</td>                     
                          <td>{{ row|get_item:"total_vl_eid_sam"|default:0 }}</td>
                          <td> {{ row|get_item:"total_vl_eid_res"|default:0 }}   </td>
                          <td >{{ row|get_item:"Sputum_Culture_DR_NTBRL"|default:0 }}    </td>
                          <td > {{ row|get_item:"Sputum_Culture_DR_NTBRL_res"|default:0 }}  </td>

                          <td > {{ row|get_item:"VL_Plasma_DBS"|default:0 }}  </td>
                          <td > {{ row|get_item:"EID_Plasma_DBS"|default:0 }}  </td>

                          <td > {{ row|get_item:"HPV"|default:0 }}  </td>
                          <td > {{ row|get_item:"HPV_res"|default:0 }}  </td>

                          <td > {{ row|get_item:"VL_Plasma_DBS_res"|default:0 }}  </td>
                          <td > {{ row|get_item:"EID_Plasma_DBS_res"|default:0 }}  </td>
                      </tr>
                  {% endfor %}
              {% endif %}
          {% endfor %}
          </tbody>
      </table>
                        


<script>
jQuery_3_6_0(document).ready(function () {
    jQuery_3_6_0(".display").DataTable({
        dom: 'Bfrtip',
        pageLength: 50 , // Display 50 rows by default
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    });
});
</script>
              





<script type="text/javascript">
    $(document).ready(function() {
        $('#submitfilterx').on('click', function(e) {
          // Add loading class and update button text
            submitButton.prop('disabled', true).addClass('loading').html('Loading...');
            var submitButton = $('#submitfilterx'); 
            var startdateVal = $('#startdate').val();
            var enddateVal = $('#enddate').val();
    
            var starting = new Date(startdateVal);
            var ending = new Date(enddateVal);
            var today = new Date();
            today.setHours(0, 0, 0, 0);
    
            if (startdateVal == '' || enddateVal == '') {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting > today || ending > today) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting > ending) {
                $("#response-msg-container").html(`
                Start date should not be greater than end date 
                `);
                $("#startdate").focus();
                return;
            } else if ((ending.getTime() - starting.getTime()) / (1000 * 3600 * 24) != 7) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting.getDay() != 1 || ending.getDay() != 0) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else {
    
              
                $.ajax({
                     type: 'POST', 
                     type: "POST",
                        url: '{% url 'relief_spec_and_res' %}', 
                        data: {
                          startdate: startdate,
                          enddate: enddate,
                          csrfmiddlewaretoken: '{{ csrf_token }}', // Include the CSRF token in the data
                        },
                        success: function (response) {
                        $('#response-msg-container').html('<div class="alert alert-error" role="alert">' + responsd + '</div>');
    
                        },
                        error: function(error) {
                              console.log(error);
                            }
    
               
    
    
                }); // end of ajax 
            }
        });
    });
    
    
      </script>

{% endblock content %}
