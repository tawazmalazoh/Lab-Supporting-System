{% extends "base.html" %} 
{% load static %} 
{% load crispy_forms_tags %} 
{% load custom_filters %}
{% block content %}

  <!-- SECTION FOR THE CONTENT SCRIPTS -->

  <!--  -- E Charts-->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.2.1/dist/echarts.min.js"></script>

<!-- start Data Table libraries  -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.7.0/jszip-3.10.1/dt-1.13.5/af-2.6.0/b-2.4.1/b-colvis-2.4.1/b-html5-2.4.1/b-print-2.4.1/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.1/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.css" rel="stylesheet">
 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.7.0/jszip-3.10.1/dt-1.13.5/af-2.6.0/b-2.4.1/b-colvis-2.4.1/b-html5-2.4.1/b-print-2.4.1/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.1/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
<!-- end Datatable -->
 
<script>
  var jQuery_3_6_0 = $.noConflict(true);
  </script>
  

<!-- these are libraries for MULTIPLE SELECT -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->
<script src="{% static 'assets/js/jquery.min.js'%}"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<!-- end of libraries for multiple select -->
<script>
  var jQuery_2_1_1 = $.noConflict(true);
  </script>

<!-- SweetAlert2 stylesheet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

<script type="text/javascript">
  window.onload = function() {
      document.body.style.zoom = "90%";
  }
</script>


<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src=" {% static 'assets/js/echarts.min.js'%}"></script>

<!-- Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://code.highcharts.com/highcharts-3d.js"></script>
<script src="https://code.highcharts.com/modules/pictorial.js"></script> 

<!--  -->








<style>
    .display td, .display th {
        border-right: 1px solid #ddd; /* Right border for each cell */
    }
    .display th, .display td {
        border-bottom: 1px solid #ddd; /* Bottom border for each cell */
    }
    .display tr:last-child td {
        border-bottom: none; /* Remove bottom border for the last row */
    }
    .display thead th:last-child, .display tbody td:last-child {
        border-right: none; /* Remove right border for the last column */
    }

    .wrap-comments {
    word-wrap: break-word; 
    max-width: 1600px; /* or whatever maximum width you want */
     }

        .hide-element {
        display: none;
    }

      .bg-none {
          background-color: #f3f3f3; /* or any color you'd like */
      }


          /* Targeting the 2nd, 3rd, and 4th columns of the table */
    #AgeOldestsample td:nth-child(2),
    #AgeOldestsample td:nth-child(3),
    #AgeOldestsample td:nth-child(4) {
        width: 100px; /* Or whatever width you prefer */
    }


          /* Define the rotation animation */
      @keyframes rotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
      }

      /* Apply the animation to the loading element */
      .loading {
          animation: rotate 1.5s linear infinite;
      }

 /* Style for the button */
 button {
            background-color: #e0e0e0; /* Light gray background */
            color: #a0a0a0; /* Faint text color */
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.3s; /* Transition effect for hover */
        }

        button:hover {
            background-color: #c0c0c0; /* Slightly darker gray for hover */
        }

        i.bi {
            margin-right: 5px; /* Spacing between the icon and the text */
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .rotate-icon {
            animation: rotate 2s linear infinite;
        }


        #submitsync.active {
        background-color: rgb(147, 147, 245) !important;
        border-color: rgb(147, 147, 245) !important;
        font-weight: bold;
        color: black;
        }


        #province {
                    width: 300px;  /* Adjust the width as per your requirement */
                }

</style>

<!-- the top part  -->
<form method="post" enctype="multipart/form-data" id="sync-form"></form>
{% csrf_token %}  
<div class="row">  
    <div class="col-lg-6">       
             
        <!-- <button type="button" id="submitsync"  name="submitsync"  title="ODK Sync"><i class="bi bi-arrow-repeat"  > ODK SurveyCTO Sync</i></button>        -->
    </div>
    <!-- style="font-size: 2rem;" -->
    <div class="col-lg-6">
        <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><i class="bi bi-pc-display-horizontal"  ></i></li>
              <li class="breadcrumb-item"><a href="#">Last IST Uploaded  date: </a></li>
              <li class="breadcrumb-item ">{{submission_date}}</li>
            </ol>
        </nav>
         
    </div>
   


    {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-octagon me-1"></i>
    {{ message|safe }} <br>      
     <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}    
</div>
</form>


<!-- lets put the filters -->
{% load crispy_forms_tags %}
<form method="POST">
    {% csrf_token %}

    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="alert border-primary alert-dismissible fade show" role="alert">
                    <div class="row">

                        <div class="col-lg-3" style="display: flex; align-items: center;">
                            <i class="bi bi-book-" style="font-size: 4em;"></i>
                            <span style="margin-left: 2em;">
                                <strong> Apply Filters <br> <i>By Default it shows for this week</i></strong>
                            </span>
                        </div>


                        <div class="col-lg-3">
                            <label for="inputDate" style="font-weight: bold; font-family: Arial, sans-serif;">Start
                                Date</label>
                            <input type="date" id="startdate" name="startdate" class="form-control" required>
                        </div>

                        <div class="col-lg-3">
                            <label for="inputDate" style="font-weight: bold; font-family: Arial, sans-serif;">End
                                Date</label>
                            <input type="date" id="enddate" name="enddate" class="form-control" required>
                        </div>

                        <div class="col-lg-3">
                            <label for="inputDate"
                                style="font-weight: bold; font-family: Arial, sans-serif;">.</label><br>
                            <button id="submitfilterx" name="submitfilterx" class="btn btn-primary"
                                style="font-size: 20px; ">Submit</button>

                        </div>

                    </div>

                    <div class="row">
                        <div class="col-lg-3" style="display: flex; align-items: center;">
                           </div>
                       
                        </div>



                </div>
            </div>
        </div>
    </div>
</form>



<!-- end of the top part  -->




<figure>
    <blockquote class="blockquote">
      <p>BIKE FUNCTIONALITY PER PROVINCE.</p>
    </blockquote>
    <figcaption class="blockquote-footer">
       This will show the bike functionality  <cite title="Source Title"><strong style="color: red;">PER  PROVINCE </strong></cite>  Taking into consideration the week with the holiday , the Algorithm is as below: <br><br>
       WHEN MAX_ ( Number_of_days_bike_was_functional)  = 3 'per week' AND [Number_of_days_bike_was_functional]  >= 2 THEN 'Bike is Functional' <br>
       WHEN MAX_ ( Number_of_days_bike_was_functional)  = 4 'per week' AND [Number_of_days_bike_was_functional]  > 2 THEN 'Bike is Functional' <br>
       WHEN MAX_ ( Number_of_days_bike_was_functional)  = 5 'per week' AND [Number_of_days_bike_was_functional]  > 3 THEN 'Bike is Functional' <br>
       COUNT (functional) <strong> / </strong>  [number of bike per province] <br><br>
      
    </figcaption>
  </figure>
  <div class="row">  
    <div class="col-lg-5">      
        
        <table width="100%" id="fxn" class="display table-responsive">
            <thead>
              
              <tr>
                <th>Province</th>
                <th>Functional Bikes</th>
                <th>Total Bikes </th>
                <th>(%) Bike Functionality</th>                        
              </tr>
            </thead>
            <tbody>
               {% for result in data %}
                  {% if result.query_name == 'bike_fxn_prov' %}
                      {% for row in result.query_data %}
                          <tr>
                              <td>{{ row|get_item:"Province_"|default:"" }} </td>
                              <td>{{ row|get_item:"functional_b"|default:0 }}</td>
                              <td> {{ row|get_item:"Denominator"|default:0 }}   </td>
                              <td >{{ row|get_item:"funxty"|default:0 }} %    </td>                     

                          </tr>
                      {% endfor %}
                  {% endif %}
              {% endfor %} 
              </tbody>
          </table>                  
                </div>

                    
    <div class="col-lg-7"> 
        <br> <figure>
            <blockquote class="blockquote">
              NON BIKE FUNCTIONALITY REASONS.
            </blockquote>
            
          </figure>   
        <div class="card">
            <div class="card-body">
        <div id="bubble"  style="width: 100%; height: 500px"></div>
        <!-- Include the ECharts library -->
             <script>
        document.addEventListener('DOMContentLoaded', function () {     

                var Bike_breakdown_int = [
                    {% for result in data %}
                    {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                        {% for row in result.query_data %}
                        {{ row|get_item:"Bike_breakdown"|default:0| to_int }} 
                        {% endfor %}
                    {% endif %}
                {% endfor %}];
                var Bike_breakdown=Bike_breakdown_int[0]


                var Maintanance_service_int = [ 
                {% for result in data %}
                        {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                            {% for row in result.query_data %}
                            {{ row|get_item:"Maintanance_service"|default:0| to_int }} 
                            {% endfor %}
                        {% endif %}
                    {% endfor %}];
                var Maintanance_service=Maintanance_service_int[0]


                var No_fuel_int = [
                {% for result in data %}
                            {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                {% for row in result.query_data %}
                                {{ row|get_item:"No_fuel"|default:0| to_int }} 
                                {% endfor %}
                            {% endif %}
                        {% endfor %}];
                var No_fuel=No_fuel_int[0]
                    

                var Sick_leave_int =  [
                    {% for result in data %}
                                {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                    {% for row in result.query_data %}
                                    {{ row|get_item:"Sick_leave"|default:0| to_int }} 
                                    {% endfor %}
                                {% endif %}
                            {% endfor %} ];
                    
                var Sick_leave  =Sick_leave_int[0]            

                var Annual_leave_int =  [
                        {% for result in data %}
                                    {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                        {% for row in result.query_data %}
                                        {{ row|get_item:"Annual_leave"|default:0| to_int }} 
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %} ];
                var Annual_leave=Annual_leave_int[0]               
                            

                var Inclement_weather_int = [ 
                        {% for result in data %}
                                    {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                        {% for row in result.query_data %}
                                        {{ row|get_item:"Inclement_weather"|default:0| to_int }} 
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %} ];
                var Inclement_weather=Inclement_weather_int[0]               
                            


                var Accident_damage_int =  [
                            {% for result in data %}
                                        {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                            {% for row in result.query_data %}
                                            {{ row|get_item:"Accident_damage"|default:0| to_int }} 
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %} ];
                            
                var Accident_damage=Accident_damage_int[0]                       

                var Clinical_issues_int = 
                                [  {% for result in data %}
                                            {% if result.query_name == 'ist_getRxns_nonfunctional_Bfnaty' %}
                                                {% for row in result.query_data %}
                                                {{ row|get_item:"Clinical_issues"|default:0| to_int }} 
                                                {% endfor %}
                                            {% endif %}
                                        {% endfor %}];
                var Clinical_issues=Clinical_issues_int[0]
                                
                                    
                var total = Bike_breakdown + Maintanance_service + No_fuel + Sick_leave + Annual_leave + Inclement_weather + Accident_damage + Clinical_issues;

                console.log("Total: " + total);



                Highcharts.chart('bubble', {
                    chart: {
                        type: 'pie',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: '',
                        align: 'left'
                    },
                    subtitle: {
                        text: '',
                        align: 'left'
                    },
                    accessibility: {
                        point: {
                            valueSuffix: '%'
                        }
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: '{point.name}'
                            }
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Share',
                        data: [
                            ['Bike_breakdown', Bike_breakdown],
                            ['Maintanance_service', Maintanance_service],
                            {
                                name: 'Annual_leave',
                                y: Annual_leave,
                                sliced: true,
                                selected: true
                            },
                            ['No_fuel', No_fuel],
                            ['Sick_leave', Sick_leave],
                            ['Inclement_weather', Inclement_weather],
                            ['Accident_damage', Accident_damage],
                            ['Clinical_issues',Clinical_issues]
                        ]
                    }]
                });
                   
           

            });
             </script>


                </div
            </div>
        </div>

</div>

<br><br>
<div class="col-lg-12">
    <div class="card">
        <hr>
    </div>
</div>


<figure>
    <blockquote class="blockquote">
      <p>BIKE FUNCTIONALITY PER DISTRICT.</p>
    </blockquote>
    <figcaption class="blockquote-footer">    
      
    </figcaption>
  </figure>
  <div class="row">  

               
    <div class="col-lg-8"> 
        <br> 
        <div class="card">
            <div class="card-body">
        <div id="distcxxc"  style="width: 100%; height: 500px"></div>
        <!-- Include the ECharts library -->
        <script> 
            document.addEventListener('DOMContentLoaded', function () { 

                
            var district = [ 
                {% for result in data %}
                            {% if result.query_name == 'bike_fxn_District' %}
                                {% for row in result.query_data %}
                                '{{ row|get_item:"District_"|default:0 }}', 
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
    
                    ];
            
                  var seriesFUNXT_samDict = {};
                                  {% for result in data %}
                                  {% if result.query_name == 'bike_fxn_District' %}
                                      {% for row in result.query_data %}
                                      seriesFUNXT_samDict['{{ row|get_item:"District_"|default:0 }}'] = '{{ row.funxty }}';
                                      {% endfor %}
                                  {% endif %}
                                  {% endfor %}
                
                  var seriesFUNXT_sam = district.map(function(o) {
                                    return parseInt(seriesFUNXT_samDict[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                                });


                var seriesTARGET_samDict = {};
                                {% for result in data %}
                                {% if result.query_name == 'bike_fxn_District' %}
                                    {% for row in result.query_data %}
                                    seriesTARGET_samDict['{{ row|get_item:"District_"|default:0 }}'] = '{{ row.target }}';
                                    {% endfor %}
                                {% endif %}
                                {% endfor %}
              
                var seriesTARGET_sam = district.map(function(o) {
                                  return parseInt(seriesTARGET_samDict[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                              });
  
    

         
  
                
                Highcharts.chart('distcxxc', {
                    chart: {
                        zoomType: 'xy'
                    },
                    title: {
                        text: '',
                        align: 'left'
                    },
                    
                    xAxis: [{
                        categories: district,
                        crosshair: true
                    }],
                    yAxis: [{ // Primary yAxis
                        labels: {
                            format: '{value} ',
                            style: {
                                color: Highcharts.getOptions().colors[2]
                            }
                        },
                        title: {
                            text: '',
                            style: {
                                color: Highcharts.getOptions().colors[2]
                            }
                        },
                        opposite: true
                
                    }, { // Secondary yAxis
                        gridLineWidth: 0,
                        title: {
                            text: '% functionality',
                            style: {
                                color: Highcharts.getOptions().colors[0]
                            }
                        },
                        labels: {
                            format: '{value} %',
                            style: {
                                color: Highcharts.getOptions().colors[0]
                            }
                        }
                
                    }, { // Tertiary yAxis
                        gridLineWidth: 0,
                        title: {
                            text: '',
                            style: {
                                color: Highcharts.getOptions().colors[1]
                            }
                        },
                        labels: {
                            format: '{value} ',
                            style: {
                                color: Highcharts.getOptions().colors[1]
                            }
                        },
                        opposite: true
                    }],
                    tooltip: {
                        shared: true
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        x: 80,
                        verticalAlign: 'top',
                        y: 55,
                        floating: true,
                        backgroundColor:
                            Highcharts.defaultOptions.legend.backgroundColor || // theme
                            'rgba(255,255,255,0.25)'
                    },
                    series: [{
                        name: '% Functionality',
                        type: 'column',
                        yAxis: 1,
                        data: seriesFUNXT_sam,
                        tooltip: {
                            valueSuffix: ' %'
                        }
                
                    },  {
                        name: 'Target',
                        type: 'spline',
                        data: seriesTARGET_sam,
                        yAxis: 1,
                        tooltip: {
                            valueSuffix: ' %'
                        }
                    }
                    ],
                    responsive: {
                        rules: [{
                            condition: {
                                maxWidth: 500
                            },
                            chartOptions: {
                                legend: {
                                    floating: false,
                                    layout: 'horizontal',
                                    align: 'center',
                                    verticalAlign: 'bottom',
                                    x: 0,
                                    y: 0
                                },
                                yAxis: [ {
                                    labels: {
                                        align: 'left',
                                        x: 0,
                                        y: -6
                                    },
                                    showLastLabel: false
                                }, {
                                    visible: false
                                }]
                            }
                        }]
                    }
                });
                


            });
        </script>
                </div>
            </div>
        </div>




    <div class="col-lg-4">      
        
        <table width="100%" id="fxndis" class="display table-responsive">
            <thead>
              
              <tr>
                <th>District</th>
                <th>Functional Bikes</th>
                <th>Total Bikes </th>
                <th>(%) Bike Functionality</th>                        
              </tr>
            </thead>
            <tbody>
               {% for result in data %}
                  {% if result.query_name == 'bike_fxn_District' %}
                      {% for row in result.query_data %}
                          <tr>
                              <td>{{ row|get_item:"District_"|default:"" }} </td>
                              <td>{{ row|get_item:"functional_b"|default:0 }}</td>
                              <td> {{ row|get_item:"Denominator"|default:0 }}   </td>
                              <td >{{ row|get_item:"funxty"|default:0 }} %    </td>                     

                          </tr>
                      {% endfor %}
                  {% endif %}
              {% endfor %} 
              </tbody>
          </table>                  
                </div>

</div>

<br><br>
<div class="col-lg-12">
    <div class="card">
        <hr>
    </div>
</div>



<figure>
    <blockquote class="blockquote">
      <p>GLOBAL FUND DISTRICTS -Bike functionality.</p>
    </blockquote>
    <figcaption class="blockquote-footer">    
      These are Global Fund (TA-DSI)  districts only 
    </figcaption>
  </figure>


  <div class="row">          
   
<div class="col-lg-4">      
    <table width="100%" id="fxndis" class="display table-responsive">
        <thead>
          
          <tr>
            <th>District</th>
            <th>Functional Bikes</th>
            <th>Total Bikes </th>
            <th>(%) Bike Functionality</th>                        
          </tr>
        </thead>
        <tbody>
           {% for result in data %}
              {% if result.query_name == 'bike_fxn_GF' %}
                  {% for row in result.query_data %}
                      <tr>
                          <td>{{ row|get_item:"District_"|default:"" }} </td>
                          <td>{{ row|get_item:"functional_b"|default:0 }}</td>
                          <td> {{ row|get_item:"Denominator"|default:0 }}   </td>
                          <td >{{ row|get_item:"funxty"|default:0 }} %    </td>                     

                      </tr>
                  {% endfor %}
              {% endif %}
          {% endfor %} 
          </tbody>
      </table>             
    
            </div>

            <div class="col-lg-8"> 
                <div id="GFdistrict"  style="width: 100%; height: 500px"></div>
                <script> 
                    document.addEventListener('DOMContentLoaded', function () { 
        
                        
                    var districti = [ 
                        {% for result in data %}
                                    {% if result.query_name == 'bike_fxn_GF' %}
                                        {% for row in result.query_data %}
                                        '{{ row|get_item:"District_"|default:0 }}', 
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
            
                            ];
                    
                          var seriesFUNXT_samDictGF = {};
                                          {% for result in data %}
                                          {% if result.query_name == 'bike_fxn_GF' %}
                                              {% for row in result.query_data %}
                                              seriesFUNXT_samDictGF['{{ row|get_item:"District_"|default:0 }}'] = '{{ row.funxty }}';
                                              {% endfor %}
                                          {% endif %}
                                          {% endfor %}
                        
                          var seriesFUNXT_samGF = districti.map(function(o) {
                                            return parseInt(seriesFUNXT_samDictGF[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                                        });
        
        
                        var seriesTARGET_samDictGF = {};
                                        {% for result in data %}
                                        {% if result.query_name == 'bike_fxn_GF' %}
                                            {% for row in result.query_data %}
                                            seriesTARGET_samDictGF['{{ row|get_item:"District_"|default:0 }}'] = '{{ row.target }}';
                                            {% endfor %}
                                        {% endif %}
                                        {% endfor %}
                      
                        var seriesTARGET_samGF = districti.map(function(o) {
                                          return parseInt(seriesTARGET_samDictGF[o], 10) || 0; // The "|| 0" ensures you get a number even if the parse fails
                                      });
          
            
        
                 
          
                        
                        Highcharts.chart('GFdistrict', {
                            chart: {
                                zoomType: 'xy'
                            },
                            title: {
                                text: '',
                                align: 'left'
                            },
                            
                            xAxis: [{
                                categories: districti,
                                crosshair: true
                            }],
                            yAxis: [{ // Primary yAxis
                                labels: {
                                    format: '{value} ',
                                    style: {
                                        color: Highcharts.getOptions().colors[2]
                                    }
                                },
                                title: {
                                    text: '',
                                    style: {
                                        color: Highcharts.getOptions().colors[2]
                                    }
                                },
                                opposite: true
                        
                            }, { // Secondary yAxis
                                gridLineWidth: 0,
                                title: {
                                    text: '% functionality',
                                    style: {
                                        color: Highcharts.getOptions().colors[0]
                                    }
                                },
                                labels: {
                                    format: '{value} %',
                                    style: {
                                        color: Highcharts.getOptions().colors[0]
                                    }
                                }
                        
                            }, { // Tertiary yAxis
                                gridLineWidth: 0,
                                title: {
                                    text: '',
                                    style: {
                                        color: Highcharts.getOptions().colors[1]
                                    }
                                },
                                labels: {
                                    format: '{value} ',
                                    style: {
                                        color: Highcharts.getOptions().colors[1]
                                    }
                                },
                                opposite: true
                            }],
                            tooltip: {
                                shared: true
                            },
                            legend: {
                                layout: 'vertical',
                                align: 'left',
                                x: 80,
                                verticalAlign: 'top',
                                y: 55,
                                floating: true,
                                backgroundColor:
                                    Highcharts.defaultOptions.legend.backgroundColor || // theme
                                    'rgba(255,255,255,0.25)'
                            },
                            series: [{
                                name: '% Functionality',
                                type: 'column',
                                yAxis: 1,
                                data: seriesFUNXT_samGF,
                                tooltip: {
                                    valueSuffix: ' %'
                                }
                        
                            },  {
                                name: 'Target',
                                type: 'spline',
                                data: seriesTARGET_samGF,
                                yAxis: 1,
                                tooltip: {
                                    valueSuffix: ' %'
                                }
                            }
                            ],
                            responsive: {
                                rules: [{
                                    condition: {
                                        maxWidth: 500
                                    },
                                    chartOptions: {
                                        legend: {
                                            floating: false,
                                            layout: 'horizontal',
                                            align: 'center',
                                            verticalAlign: 'middle',
                                            x: 0,
                                            y: -100
                                        },
                                        yAxis: [ {
                                            labels: {
                                                align: 'left',
                                                x: 0,
                                                y: -100
                                            },
                                            showLastLabel: true
                                        }, {
                                            visible: true
                                        }]
                                    }
                                }]
                            }
                        });                     
        
        
                    });
                </script>


            </div>

        </div>



<script>
jQuery_3_6_0(document).ready(function () {
    jQuery_3_6_0(".display").DataTable({
        dom: 'Bfrtip',
        pageLength: 10 , // Display 50 rows by default
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    });
});
</script>



<script type="text/javascript">
    $(document).ready(function() {
        $('#submitfilterx').on('click', function(e) {
          // Add loading class and update button text
            submitButton.prop('disabled', true).addClass('loading').html('Loading...');
            var submitButton = $('#submitfilterx'); 
            var startdateVal = $('#startdate').val();
            var enddateVal = $('#enddate').val();
    
            var starting = new Date(startdateVal);
            var ending = new Date(enddateVal);
            var today = new Date();
            today.setHours(0, 0, 0, 0);
    
            if (startdateVal == '' || enddateVal == '') {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting > today || ending > today) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting > ending) {
                $("#response-msg-container").html(`
                Start date should not be greater than end date 
                `);
                $("#startdate").focus();
                return;
            } else if ((ending.getTime() - starting.getTime()) / (1000 * 3600 * 24) != 7) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else if (starting.getDay() != 1 || ending.getDay() != 0) {
                $("#response-msg-container").html(`
                    ...
                `);
                $("#startdate").focus();
                return;
            } else {
    
              
                $.ajax({
                     type: 'POST', 
                     type: "POST",
                        url: '{% url 'IST_specimens_and_results' %}', 
                        data: {
                          startdate: startdate,
                          enddate: enddate,
                          csrfmiddlewaretoken: '{{ csrf_token }}', // Include the CSRF token in the data
                        },
                        success: function (response) {
                        $('#response-msg-container').html('<div class="alert alert-error" role="alert">' + responsd + '</div>');
    
                        },
                        error: function(error) {
                              console.log(error);
                            }
    
                            complete: function() {
                        // Revert the button text and appearance after processing is complete
                                            submitButton.prop('disabled', false).html('Submit');
                                        }
    
    
                }); // end of ajax 
            }
        });
    });
    
    
      </script>

{% endblock content %}